<!doctype html>
<html lang="ja" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-devSpecification/SPN/hub" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">SPN Hub | Chip-in V2</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://chip-in-v2.github.io/img/devsecops.svg"><meta data-rh="true" name="twitter:image" content="https://chip-in-v2.github.io/img/devsecops.svg"><meta data-rh="true" property="og:url" content="https://chip-in-v2.github.io/docs/devSpecification/SPN/hub"><meta data-rh="true" property="og:locale" content="ja"><meta data-rh="true" name="docusaurus_locale" content="ja"><meta data-rh="true" name="docsearch:language" content="ja"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="SPN Hub | Chip-in V2"><meta data-rh="true" name="description" content="SPN Hub では SPN エンドポイントからの QUIC での接続を受け付けて、仮想的で閉じたネットワークを提供します。"><meta data-rh="true" property="og:description" content="SPN Hub では SPN エンドポイントからの QUIC での接続を受け付けて、仮想的で閉じたネットワークを提供します。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://chip-in-v2.github.io/docs/devSpecification/SPN/hub"><link data-rh="true" rel="alternate" href="https://chip-in-v2.github.io/docs/devSpecification/SPN/hub" hreflang="ja"><link data-rh="true" rel="alternate" href="https://chip-in-v2.github.io/docs/devSpecification/SPN/hub" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"SPN","item":"https://chip-in-v2.github.io/docs/devSpecification/SPN/overview"},{"@type":"ListItem","position":2,"name":"SPN Hub","item":"https://chip-in-v2.github.io/docs/devSpecification/SPN/hub"}]}</script><link rel="stylesheet" href="/assets/css/styles.c5549363.css">
<script src="/assets/js/runtime~main.9234574d.js" defer="defer"></script>
<script src="/assets/js/main.d13c74e5.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/chip-in-logo-text.png"><div role="region" aria-label="メインコンテンツまでスキップ"><a class="skipToContent_G6ar" href="#__docusaurus_skipToContent_fallback">メインコンテンツまでスキップ</a></div><nav aria-label="ナビゲーション" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="ナビゲーションバーを開く" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/chip-in-logo-text.png" alt="Chip-in Logo" class="themedComponent_DHUr themedComponent--light_DIHH"><img src="/img/chip-in-logo-text.png" alt="Chip-in Logo" class="themedComponent_DHUr themedComponent--dark_Bv2M"></div><b class="navbar__title text--truncate"></b></a><a class="navbar__item navbar__link" href="/docs/devDesign/index">設計書</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/devSpecification/SPN/overview">仕様書/テスト項目書</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/orgs/chip-in-v2/repositories" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_awgD"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_OLSw colorModeToggle_Hg9V"><button class="clean-btn toggleButton_wYmb toggleButtonDisabled_vaDU" type="button" disabled="" title="システムモード" aria-label="ダークモードを切り替える(現在はシステムモード)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_KEbZ lightToggleIcon_Sxwe"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_KEbZ darkToggleIcon_Yem1"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_KEbZ systemToggleIcon_txm5"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_bmvg"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_UyTV"><div class="docsWrapper_XLvK"><button aria-label="先頭へ戻る" class="clean-btn theme-back-to-top-button backToTopButton_z1FD" type="button"></button><div class="docRoot_HciC"><aside class="theme-doc-sidebar-container docSidebarContainer_e5ai"><div class="sidebarViewport_N8x0"><div class="sidebar_vJCc"><nav aria-label="ドキュメントのサイドバー" class="menu thin-scrollbar menu_qiME"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/devSpecification/SPN/overview">SPN</a><button aria-label="&#x27;SPN&#x27;の目次を隠す" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/devSpecification/SPN/hub">SPN Hub</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devSpecification/SPN/crate">SPN エンドポイント crate</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devSpecification/SPN/agent">SPN エージェント</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/devSpecification/APIGateway/overview">API Gateway</a><button aria-label="&#x27;API Gateway&#x27;の目次を開く" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/devSpecification/inventory-openapi">インベントリAPIリファレンス</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/devSpecification/zone-openapi">ゾーンAPIリファレンス</a></li></ul></nav></div></div></aside><main class="docMainContainer_namt"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_YAwJ"><div class="docItemContainer_Rv5Z"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_zCmv" aria-label="パンくずリストのナビゲーション"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="ホームページ" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_JFrk"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/devSpecification/SPN/overview"><span>SPN</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">SPN Hub</span></li></ul></nav><div class="tocCollapsible_O_Qc theme-doc-toc-mobile tocMobile_tjDr"><button type="button" class="clean-btn tocCollapsibleButton_htYj">このページの見出し</button></div><div class="theme-doc-markdown markdown"><header><h1>SPN Hub</h1></header>
<p>SPN Hub では SPN エンドポイントからの QUIC での接続を受け付けて、仮想的で閉じたネットワークを提供します。</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="spn-エンドポイント">SPN エンドポイント<a href="#spn-エンドポイント" class="hash-link" aria-label="SPN エンドポイント への直接リンク" title="SPN エンドポイント への直接リンク">​</a></h2>
<p>SPN エンドポイントは QUIC で SPN Hub に接続するクライアントです。SPNエンドポイントは SPN create を使用して rust で開発することが可能です。
また、SPN エージェントを利用して、TCPのクライアント/サーバにも接続できます。</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="spn-セッション">SPN セッション<a href="#spn-セッション" class="hash-link" aria-label="SPN セッション への直接リンク" title="SPN セッション への直接リンク">​</a></h2>
<p>SPN セッションは QUIC のコネクションと同義ですが、SPNのコネクションとの混同を避けるためにあえて、SPN セッションと呼びます。
この他に Chip-in では HTTP のセッションやコネクションも登場しますが、それらとも区別してください。</p>
<p>QUIC コネクション確立後、最初に SPN エンドポイントから SPN Hub に向かって制御ストリームを開始します。制御ストリームの最初の通信として SPN エンドポイントはSPN hub に SPN セッション確立要求を送信します。
SPN Hub は、セッション確立要求が SPN 内のサービス定義に照らし合わせて許容されていれば SPN エンドポイントにACKを返すとともに SPN セッションオブジェクトをメモリ上に作成します。
セッション確立後も制御ストリームは接続した状態となり、さまざまな制御パケットの通信に使用されます。</p>
<p>SPN セッションオブジェクトには以下が保持されます。</p>
<table><thead><tr><th>項目名</th><th>説明</th></tr></thead><tbody><tr><td>startAt</td><td>セッション開始時刻</td></tr><tr><td>spnSessionId</td><td>セッションID（QUIC のサーバ側コネクションIDを使用する）</td></tr><tr><td>spnEndPoint</td><td>QUICコネクションの確立に使用されたクライアント証明書の Subject の値</td></tr><tr><td>endPointType</td><td>&quot;serviceProvider&quot;, &quot;serviceConsumer&quot; のいずれか</td></tr><tr><td>serviceUrn</td><td>セッションのサービスのエンドポイントのURN</td></tr><tr><td>totalConnectionCount</td><td>このセッション上で作成された SPNコネクションの総数</td></tr></tbody></table>
<p>SPN　セッションはセッションの開設時と終了時にログを出力します。ログの項目は以下の通り。</p>
<table><thead><tr><th>項目名</th><th>説明</th></tr></thead><tbody><tr><td>timestamp</td><td>イベント発生時刻（ログの出力時刻と異なる場合があるのでイベント発生時の時刻を記録する）</td></tr><tr><td>spnSessionId</td><td>セッションID（QUIC のサーバ側コネクションIDを使用する）</td></tr><tr><td>spnEndPoint</td><td>QUICコネクションの確立に使用されたクライアント証明書の Subject の値</td></tr><tr><td>eventType</td><td>&quot;startSpnSession&quot;, &quot;endSpnSession&quot; のいずれか</td></tr><tr><td>endPointType</td><td>&quot;serviceProvider&quot;, &quot;serviceConsumer&quot; のいずれか</td></tr><tr><td>serviceUrn</td><td>セッションのサービスのURN</td></tr><tr><td>totalConnectionCount</td><td>このセッション上で作成された SPNコネクションの総数。endSpnSession のときのみ出力される</td></tr><tr><td>elapsedTime</td><td>セッション開設時からの経過時間。endSpnSession のときのみ出力される</td></tr><tr><td>terminateReason</td><td>セッションの終了理由。&quot;shutdown&quot;, &quot;terminatedByPeer&quot;, &quot;error&quot; のいずれか。endSpnSession のときのみ出力される</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id="エンドポイント側セッション管理">エンドポイント側セッション管理<a href="#エンドポイント側セッション管理" class="hash-link" aria-label="エンドポイント側セッション管理 への直接リンク" title="エンドポイント側セッション管理 への直接リンク">​</a></h3>
<p>エンドポイント側のSPN セッションは以下のように状態遷移します。</p>
<img decoding="async" loading="lazy" src="https://www.plantuml.com/plantuml/svg/dL9BJiCm4Dtx54F4WbJg1LYWIg4LaL0K6Y4MLHUEFMqi73lOuvRU7gL9f7ue59RslDyy-uOgh15ymmLgNhA99-uer9ffN16G1QVM5O5K3WKfQzXYj8Jn-07IV6Q3aN0Fjpu8WTxVHKLBXgcHZLM6elX7S8PRI7Fe1kKE6dHefHBmc1MGL2ZUevWDn5QaGE-LDOarfirYraTo_NKKitDSovvwugLMliAJp1twS7vHuushCz-NrpI10MSDpBZIVvJ8dTqeYGuoIrqVKSm6uE-Rpv7Sxg9Xb-U8aERmR3srfLiZiUP67fL-jT3U6H8R3C7qKo3A_UQ7LRVCH5j_6leWmxSFVut670Mg3K9H1P9sQs2E7m4zmShP6eeyWwTG_bUhK6l3THIp0JqmB_sVkg5T3-zz5gCbwriRZXCqCjJw2m00" class="img__Ss2">
<h4 class="anchor anchorWithStickyNavbar_fF9Z" id="snp-hub-のマルチインスタンス">SNP Hub のマルチインスタンス<a href="#snp-hub-のマルチインスタンス" class="hash-link" aria-label="SNP Hub のマルチインスタンス への直接リンク" title="SNP Hub のマルチインスタンス への直接リンク">​</a></h4>
<p>SPN Hub は複数稼働させることができます。ただし、それぞれの SPN Hub は異なるグローバルIPを持ちます。
DNS上では SPN Hub の1個のFQDNに対して起動中のグローバルIPアドレスをすべて返すようにします。
エンドポイント側では、起動時に SPN Hub の FQDN を解決し、得られたグローバルIPアドレスの全てに対してセッションを確立します。
また、定期的に SPN Hub の FQDN を解決し、得られたグローバルIPアドレスの変化を監視します。グローバルIPが削除された場合は、内包するコネクションを中断してセッションを終了し別の SPN Hub に接続し直してコネクションを再開します。</p>
<p>エンドポイント側で複数の SPN セッションがある状態で新しいコネクションが必要となった場合はどれか一つのセッションを選択してコネクションを確立します。</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="spn-コネクション">SPN コネクション<a href="#spn-コネクション" class="hash-link" aria-label="SPN コネクション への直接リンク" title="SPN コネクション への直接リンク">​</a></h2>
<p>SPN コネクションは QUIC のコネクションと異なり、serviceConsumer エンドポイントから SPN Hub を経由して serviceProvider エンドポイントに接続するストリームです。
SPN コネクションは以下の構成要素からなります。</p>
<ul>
<li>serviceConsumer エンドポイントと SPN Hub の間の双方向 QUIC ストリーム</li>
<li>SPN Hub と serviceProvider エンドポイントの間の双方向 QUIC ストリーム</li>
<li>SPN コネクション管理オブジェクト</li>
</ul>
<p>SPNコネクションの確立は</p>
<ol>
<li>serviceConsumer エンドポイントは SPN Hub との間の双方向 QUIC ストリーム上に最初のパケットを送る</li>
<li>SPN Hub は serviceProvider エンドポイントとの間の双方向 QUIC ストリーム上にそのパケットを転送する
SPN コネクションオブジェクトには以下が保持されます。</li>
</ol>
<table><thead><tr><th>項目名</th><th>説明</th></tr></thead><tbody><tr><td>startAt</td><td>コネクション開始時刻</td></tr><tr><td>spnConnectionId</td><td>SPNコネクションID（QUIC のストリームIDを serviceConsumer側、serviceProvider側の順に連結したものを使用する）</td></tr><tr><td>consumerSideSpnSessionId</td><td>serviceConsumer側 SPN セッションのID</td></tr><tr><td>providerSideSpnSessionId</td><td>serviceProvider側 SPN セッションのID</td></tr><tr><td>totalSentBytes</td><td>このストリーム上で serviceConsumerからserviceProviderに送信したデータの累計バイト数</td></tr><tr><td>totalReceiveBytes</td><td>このストリーム上で serviceConsumer がserviceProviderから受信したデータの累計バイト数</td></tr></tbody></table>
<p>SPN　セッションはセッションの開設時と終了時にログを出力します。ログの項目は以下の通り。</p>
<table><thead><tr><th>項目名</th><th>説明</th></tr></thead><tbody><tr><td>timestamp</td><td>イベント発生時刻（ログの出力時刻と異なる場合があるのでイベント発生時の時刻を記録する）</td></tr><tr><td>spnConnectionId</td><td>SPNコネクションID（QUIC のストリームIDを serviceConsumer側、serviceProvider側の順に連結したものを使用する）</td></tr><tr><td>eventType</td><td>&quot;startSpnConnection&quot;, &quot;endSpnConnection&quot; のいずれか</td></tr><tr><td>consumerSideSpnSessionId</td><td>serviceConsumer側 SPN セッションのID</td></tr><tr><td>providerSideSpnSessionId</td><td>serviceProvider側 SPN セッションのID</td></tr><tr><td>totalSentBytes</td><td>このストリーム上で serviceConsumerからserviceProviderに送信したデータの累計バイト数。 endSpnConnection のときのみ出力される</td></tr><tr><td>totalReceiveBytes</td><td>このストリーム上で serviceConsumer がserviceProviderから受信したデータの累計バイト数。 endSpnConnection のときのみ出力される</td></tr><tr><td>elapsedTime</td><td>コネクション開設時からの経過時間。 endSpnConnection のときのみ出力される</td></tr><tr><td>disconnectReason</td><td>コネクションの切断理由。&quot;closedByPeer&quot;, &quot;closed&quot;, &quot;error&quot; のいずれか。 endSpnConnection のときのみ出力される</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id="コネクションの終了">コネクションの終了<a href="#コネクションの終了" class="hash-link" aria-label="コネクションの終了 への直接リンク" title="コネクションの終了 への直接リンク">​</a></h3>
<p>コネクションは SPN エンドポイント側からの終了要求により終了します。</p>
<img decoding="async" loading="lazy" src="https://www.plantuml.com/plantuml/svg/dP0z2i9044Rxd69SBBJ81ImaiXQ28C6SOBCPKDZTYVFZ-OLWR2o2zjzxFBwLtZ0Zo1WYfj1NZMXWjPmgJqKi8qDTxy5rxGLErhiThCLYH96Dyua4uOeFGr6W0fwACYNeb35ajwq-s2HfcPxt0Vb7nuovfPA3F_zPSGmQtdkON5_K_COIrM0PBASN" alt="Close Flow" class="img__Ss2">
<p>上記は Consumer 側からのコネクション終了要求のフローですが、Provider 側からの終了要求も同様に行われます。</p>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id="コネクションの中断と再開">コネクションの中断と再開<a href="#コネクションの中断と再開" class="hash-link" aria-label="コネクションの中断と再開 への直接リンク" title="コネクションの中断と再開 への直接リンク">​</a></h3>
<p>コネクションは SPN Hub 側からの中断要求により中断されます。これは、 SPN Hub がサービスのメンテナンスや再起動を行う場合に発生します。</p>
<img decoding="async" loading="lazy" src="https://www.plantuml.com/plantuml/svg/dT0z2i9040NWFgSO5mijSW4BYQo58CXYJZ3P32ZiJzoPyVmM6WiD-DFF-nvlPdAYIC03UWhOLGqB5j4OAjEw0-oqCr3NQt0bNyyzbHNCMRqdveLng4nmf8iI2-G4DYSfEK0hXJ2QvOjXSsADFnjZzHrvak_AnkwdXR7uV-7ZBxOe-BW76pBJL-kdKWsbNcEu0G00" alt="Close Flow" class="img__Ss2">
<p>コネクションはエンドポイント側からの再開要求により再開されます。</p>
<img decoding="async" loading="lazy" src="https://www.plantuml.com/plantuml/svg/fT0z2i9040NWVayn3XPQv08M4baBGP1WJh3P32ZiJvoPzVoYi8LW4RL_x-Fn5dgXI22JynJSO5fHnrfYCDXnlbz7OeIcsGBstGaEPS0DBALuJo8hF9EKIC1qAoGAEO7DIJa7w9N9HLmRj3azG_yojVTIwhGFoCuUPm1rr3V0_3_sJjrF3xmNMqfZYU41" alt="Close Flow" class="img__Ss2">
<p>SPN Hub の再開可能なシャットダウンにおけるエンドポイントととのフローは以下の通りです。</p>
<img decoding="async" loading="lazy" src="https://www.plantuml.com/plantuml/svg/dT1D2i9038RXVKyH1nTsqGkua4eHX88KUuBfDDB2J5AR35vVfDOVT24Uu7tu-1RQOK2GmJhqjaboKJjg33unTNM0VMmCPDa6TjGEt9EkOIdHEHHPcHf5UYQekwWjNmYEU8ueQj8Vuif6mRa0PR3UGy54wBHdaXioTvFoC3-PRL72QUJm3NbRyYHVaSApu9y3flP-XKcJ7AcDmLy1" class="img__Ss2">
<p>SPN Hub が複数インスタンスの状態で1個の SPN Hub を停止する場合は全てのエンドポイントに再開可能なシャットダウンを通知します。
エンドポイントはコネクションを中断しますが、すぐに別の SPN Hub に接続し直すことができます。
SPN Hub のローリングアップデートやサーバ再起動のためのマイグレーションの場合は、一旦新しいSPN Hub を起動してから、古い SPN Hub に再開可能なシャットダウンをかけることでエンドポイント間の通信は継続されます。</p>
<p>SPN Hub の計画停止については、エンドポイントを Consumer -&gt; Provider の順にシャットダウンし、その後、 SPN Hub を停止します。
それ以外の全てのケースではエンドポイント側でエラーが発生します。</p>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id="エンドポイント状態遷移">エンドポイント状態遷移<a href="#エンドポイント状態遷移" class="hash-link" aria-label="エンドポイント状態遷移 への直接リンク" title="エンドポイント状態遷移 への直接リンク">​</a></h3>
<p>エンドポイントのコネクションの状態遷移は以下の通り。</p>
<img decoding="async" loading="lazy" src="https://www.plantuml.com/plantuml/svg/bP1TIyCm58RlyokEHOORx0zu8PDE4HGP2rwDNQJ9MHlCnyn91F-zj6lgMXNqCYVly-JalOWDMWGw2eb6L6n5KOIOh6463n6YXw3h9eBI0MNKth7TOW_BvGqyUV-gNVrov4ZKNam7NQhqphMWg-4QBYb9YKHNnRrFJa4VBERiB7P6eHf1EUGTt54KbT7KeFgYKNNmMfFy-LMEuLrB1AuLGcayeOBP33WwTJh25jyIKlpct8X4Krix6mXKS0ZU0jyymqEg1kqfT5i-5dEM9Lau-TvQH04y1XGsBrTzP66Fz-jiaPBzhTEXr27rfqgxT5VdkC1nfV_SUGIsfjrYprReLBBc4m00" class="img__Ss2">
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id="provider-のマルチインスタンスについて">Provider のマルチインスタンスについて<a href="#provider-のマルチインスタンスについて" class="hash-link" aria-label="Provider のマルチインスタンスについて への直接リンク" title="Provider のマルチインスタンスについて への直接リンク">​</a></h3>
<p>Providerから複数のセッション接続がある場合、デフォルトでは冗長負荷分散で動作します。
インベントリのサービス定義にそのサービスがシングルトンであるかどうかを示すフラグ <code>singleton</code> があり、これがtrue の場合、サービスはシングルトンであり、SPN Hub は2個目のサービスの接続を受け付けず、単一のインスタンスでの動作のみとなります。</p>
<p>false の場合、SPN Hub は複数のセッションを受け付け、コネクションごとに付加分散して接続します。
Consumer から接続があった際に最も接続数の少ないサービスに接続します。
Provider は分散重み付を変更することができます。重み付値のデフォルトは 100 であり、SPN Hub は接続されているすべての Provider インスタンスの重み付を合計して、インスタンスごとの按分値を算出します。コネクション接続時に按分値と現在の接続数を比較して、接続数の少ないインスタンスに接続します。
ローリングアップデート時は重み付を0に変更してからグレースフルシャットダウンを行うことで、無停止でのアップデートが可能となります。</p>
<img decoding="async" loading="lazy" src="https://www.plantuml.com/plantuml/svg/ZSu_2y8m48VXFP_Y30uw59mTfDB5IGeTdDFaC0VvKt8N_VgIWjBHyU3tFjnEF4O4Nep5O6RLivWYDGQbnv9VvB1ewBeBw6cymwtE-WnxhjOYyq5FAF10Ude1oN3IH_MRhT6Ns3P3o8mmv9JG2kK4RnBVRguH2r0Y8IFe6lR72zSGDXZ3ohUun-Hg31y0" class="img__Ss2">
<p>Provider の重み付が 0　に設定された後、Consumer からの新しい接続別の Provider インスタンスに接続されます。</p>
<p>Consumer と Provider 間のコネクションのグレースフルシャットダウンについてはアプリケーション層で実装する必要があります。例えば、 HTTP の場合は Provider 側から Keep-Alive ヘッダを使用して、コネクションの終了を通知することができます。また、Consumer 側では Keep Alive のタイムアウトで接続をやり直すので、コネクションは破棄されます。</p>
<p>すべてのコネクションが新しい Provider インスタンスに接続されると、古い Provider インスタンスとのセッションは切断され、インスタンスは終了します。</p>
<h2 class="anchor anchorWithStickyNavbar_fF9Z" id="spnhub-コマンド">spnhub コマンド<a href="#spnhub-コマンド" class="hash-link" aria-label="spnhub コマンド への直接リンク" title="spnhub コマンド への直接リンク">​</a></h2>
<p>spnhub コマンドは SPN Hub を実装します。spnhub コマンドのパラメータはコマンドラインオプションと環境変数のいずれかで指定できます。
パラメータには以下のものがあります。</p>
<table><thead><tr><th>オプション</th><th>環境変数名</th><th>説明</th><th>デフォルト</th></tr></thead><tbody><tr><td>-c</td><td>SPNHUB_INVENTORY_URL</td><td>SPN Hub の構成情報を提供するインベントリのURL。</td><td><a href="http://localhost:8080" target="_blank" rel="noopener noreferrer">http://localhost:8080</a></td></tr></tbody></table>
<p>spnhubコマンドは起動時とリロードシグナル受信時に構成情報を<a href="/docs/devSpecification/inventory-openapi">インベントリ</a> から読み込みます。具体的には以下の順に読み込みます。リロードシグナルは SIGUSR1 です。</p>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id="1-レルムの読み込み">1. レルムの読み込み<a href="#1-レルムの読み込み" class="hash-link" aria-label="1. レルムの読み込み への直接リンク" title="1. レルムの読み込み への直接リンク">​</a></h3>
<p>全てのレルムを読み込みます。
SPN Hub はレルムごとに内部が分離されており、マルチテナントのシステムを容易に実装できます。</p>
<div class="redocusaurus redocusaurus-schema hide-example"><div class="sc-dTvVRJ ipMzWx"><div class="sc-jJLAfE jhaFXr"><div class="sc-ggWZvA gnAKQH"><table class="sc-eqNDNG dnhmEK"><tbody><tr class=""><td kind="field" title="name" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">name</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span><span class="sc-bEjUoa sc-cpclqO lhsTlU dDErjj">^[a-z0-9][a-z0-9-]*$</span></div> <div><div html="&lt;p&gt;レルムの名前。URN の一部として使用される。
文字列は小文字英字、数字、ハイフンのみを含むことができる。
ただし、ハイフンで始まることはできない。
名称 &amp;quot;master&amp;quot; は予約されており、使用できない。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>レルムの名前。URN の一部として使用される。
文字列は小文字英字、数字、ハイフンのみを含むことができる。
ただし、ハイフンで始まることはできない。
名称 &quot;master&quot; は予約されており、使用できない。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="title" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">title</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;レルムの日本語名称です。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>レルムの日本語名称です。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="description" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">description</span></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;レルムの説明文です。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>レルムの説明文です。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="urn" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">urn</span></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu"> <!-- -->&lt;<!-- -->urn<!-- -->&gt;<!-- --> </span></div> <div><div html="&lt;p&gt;レルムのURN。形式は &lt;code&gt;urn:chip-in:realm:{realm-name}&lt;/code&gt; である。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>レルムのURN。形式は <code>urn:chip-in:realm:{realm-name}</code> である。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="cacert" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">cacert</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;realm 配下の SPN hub で mTLSにおけるクライアント証明書を発行したCA局の証明書(PEM形式)の文字列&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>realm 配下の SPN hub で mTLSにおけるクライアント証明書を発行したCA局の証明書(PEM形式)の文字列</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="signingKey" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">signingKey</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span><span> <span class="sc-bEjUoa sc-goiVcJ lhsTlU ebTGGn"> <!-- -->&gt;= 24 characters<!-- --> </span></span></div> <div><div html="&lt;p&gt;realm 配下のAPI Gateway でセッショントークンの署名に使用されるパスワード。
使用できる文字は英字、数字、ハイフン、アンダースコアのみである。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>realm 配下のAPI Gateway でセッショントークンの署名に使用されるパスワード。
使用できる文字は英字、数字、ハイフン、アンダースコアのみである。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="sessionTimeout" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">sessionTimeout</span></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">integer</span></div> <div><div html="&lt;p&gt;セッショントークンの有効期限。単位は秒で、デフォルトは 2592000  秒 (30日)。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>セッショントークンの有効期限。単位は秒で、デフォルトは 2592000  秒 (30日)。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="administrators" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">administrators</span></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz">Array of </span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">strings</span></div> <div><div html="&lt;p&gt;レルムの管理者のユーザID。ユーザの管理はインベントリでは行わない。認証サービス内でのみ管理され、ここではそのIDのみを参照する。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>レルムの管理者のユーザID。ユーザの管理はインベントリでは行わない。認証サービス内でのみ管理され、ここではそのIDのみを参照する。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="expiredAt" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">expiredAt</span></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu"> <!-- -->&lt;<!-- -->date-time<!-- -->&gt;<!-- --> </span></div> <div><div html="&lt;p&gt;レルムの有効期限。ISO8601形式で指定する。
この日時を過ぎると、レルムの disabled フラグは true となり、関連するリソースへのアクセスが制限される。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>レルムの有効期限。ISO8601形式で指定する。
この日時を過ぎると、レルムの disabled フラグは true となり、関連するリソースへのアクセスが制限される。</p>
</div></div></div></td></tr><tr class="last"><td kind="field" title="disabled" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">disabled</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">boolean</span></div> <div><div html="&lt;p&gt;レルムが無効化されているかどうかを示すフラグ。
true の場合、レルムは無効化されており、関連するリソースへのアクセスが制限される。
false の場合、レルムは有効であり、通常の操作が可能である。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>レルムが無効化されているかどうかを示すフラグ。
true の場合、レルムは無効化されており、関連するリソースへのアクセスが制限される。
false の場合、レルムは有効であり、通常の操作が可能である。</p>
</div></div></div></td></tr></tbody></table></div></div></div></div>
<ul>
<li>disabled が True のものは無視します。</li>
<li>リロードにおいては、一覧の前後を比較し、追加削除を行います。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id="2-spn-hub-の構築">2. SPN Hub の構築<a href="#2-spn-hub-の構築" class="hash-link" aria-label="2. SPN Hub の構築 への直接リンク" title="2. SPN Hub の構築 への直接リンク">​</a></h3>
<p>レルムごとに SPN Hub を構築します。</p>
<div class="redocusaurus redocusaurus-schema hide-example"><div class="sc-dTvVRJ ipMzWx"><div class="sc-jJLAfE jhaFXr"><div class="sc-ggWZvA gnAKQH"><table class="sc-eqNDNG dnhmEK"><tbody><tr class=""><td kind="field" title="name" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">name</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;SPN Hub の名前。URN の一部として使用される。
文字列は小文字英字、数字、ハイフン、アンダースコアのみを含むことができる。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>SPN Hub の名前。URN の一部として使用される。
文字列は小文字英字、数字、ハイフン、アンダースコアのみを含むことができる。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="realm" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">realm</span></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu"> <!-- -->&lt;<!-- -->urn<!-- -->&gt;<!-- --> </span></div> <div><div html="&lt;p&gt;SPN Hub が属する realm の URN。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>SPN Hub が属する realm の URN。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="urn" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">urn</span></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;SPN Hub のURN。URNは、SPN Hubを一意に識別するための文字列で、以下の形式で構成される。
urn:chip-in:network:{realm}:{name}&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>SPN Hub のURN。URNは、SPN Hubを一意に識別するための文字列で、以下の形式で構成される。
urn:chip-in:network:{realm}:{name}</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="title" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">title</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;SPN Hub の日本語名称です。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>SPN Hub の日本語名称です。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="description" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">description</span></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;SPN Hub の説明文です。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>SPN Hub の説明文です。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="fqdn" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">fqdn</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;SPN Hub のサーバのFQDN&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>SPN Hub のサーバのFQDN</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="serverPort" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">serverPort</span></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">integer</span></div> <div><div html="&lt;p&gt;SPN Hub のサーバのポート番号。デフォルトは 443&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>SPN Hub のサーバのポート番号。デフォルトは 443</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="serverCert" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">serverCert</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;mTLSにおけるサーバ証明書(PEM形式)の文字列。
SPN Hub のサーバは、この証明書を使用してクライアントとの通信を暗号化する。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>mTLSにおけるサーバ証明書(PEM形式)の文字列。
SPN Hub のサーバは、この証明書を使用してクライアントとの通信を暗号化する。</p>
</div></div></div></td></tr><tr class="last"><td kind="field" title="serverCertKey" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">serverCertKey</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;mTLSにおけるサーバ証明書の秘密鍵(PEM形式)の文字列。
SPN Hub のサーバは、この秘密鍵を使用してクライアントとの通信を暗号化する。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>mTLSにおけるサーバ証明書の秘密鍵(PEM形式)の文字列。
SPN Hub のサーバは、この秘密鍵を使用してクライアントとの通信を暗号化する。</p>
</div></div></div></td></tr></tbody></table></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_fF9Z" id="3-サービスの構築">3. サービスの構築<a href="#3-サービスの構築" class="hash-link" aria-label="3. サービスの構築 への直接リンク" title="3. サービスの構築 への直接リンク">​</a></h3>
<p>SPN Hub ごとにサービスの定義を読み込みます。</p>
<div class="redocusaurus redocusaurus-schema hide-example"><div class="sc-dTvVRJ ipMzWx"><div class="sc-jJLAfE jhaFXr"><div class="sc-ggWZvA gnAKQH"><table class="sc-eqNDNG dnhmEK"><tbody><tr class=""><td kind="field" title="name" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">name</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;サービスの名前。URN の一部として使用される。
ただし、先頭がハイフンであってはならない。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>サービスの名前。URN の一部として使用される。
ただし、先頭がハイフンであってはならない。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="hub" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">hub</span></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu"> <!-- -->&lt;<!-- -->urn<!-- -->&gt;<!-- --> </span></div> <div><div html="&lt;p&gt;サービスが接続される SPN Hub のURN。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>サービスが接続される SPN Hub のURN。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="urn" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">urn</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;サービスのURN。URNは、サービスを一意に識別するための文字列で、以下の形式で構成される。&lt;br/&gt;
urn:chip-in:service:{realm}:{hubName}:{name}&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>サービスのURN。URNは、サービスを一意に識別するための文字列で、以下の形式で構成される。<br>
urn:chip-in:service:{realm}:{hubName}:{name}</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="title" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">title</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;サービスの日本語名称です。URN の一部として使用される。
文字列は日本語を含むことができる。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>サービスの日本語名称です。URN の一部として使用される。
文字列は日本語を含むことができる。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="description" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">description</span></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;サービスの説明文です。URN の一部として使用される。
文字列は日本語を含むことができる。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>サービスの説明文です。URN の一部として使用される。
文字列は日本語を含むことができる。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="realm" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">realm</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="&lt;p&gt;サービスが属するレルムの名前。&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>サービスが属するレルムの名前。</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="availabilityManagement" class="sc-kCuUfV sc-fbQrwq sc-itBLYH hkAGZU gHPYmL JMnAN"><span class="sc-hwddKA ccHsKL"></span><button aria-label="expand availabilityManagement"><span class="property-name">availabilityManagement</span><svg class="sc-dntSTA ihtenX" version="1.1" viewBox="0 0 24 24" x="0" xmlns="http://www.w3.org/2000/svg" y="0" aria-hidden="true"><polygon points="17.3 8.3 12 13.6 6.7 8.3 5.3 9.7 12 16.4 18.7 9.7 "></polygon></svg></button></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">object</span></div> <div><div html="&lt;p&gt;コンテナクラスタ内でマイクロサービスのスケジュール起動、オンデマンド起動を行うためのパラメータ&lt;/p&gt;
" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"><p>コンテナクラスタ内でマイクロサービスのスケジュール起動、オンデマンド起動を行うためのパラメータ</p>
</div></div></div></td></tr><tr class=""><td kind="field" title="singleton" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">singleton</span></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">boolean</span></div> <div><div html="" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"></div></div></div></td></tr><tr class=""><td kind="field" title="provider" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">provider</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz"></span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">string</span></div> <div><div html="" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"></div></div></div></td></tr><tr class="last"><td kind="field" title="consumers" class="sc-kCuUfV sc-fbQrwq hkAGZU gHPYmL"><span class="sc-hwddKA ccHsKL"></span><span class="property-name">consumers</span><div class="sc-bEjUoa sc-iIvHqT lhsTlU gZffex">required</div></td><td class="sc-gGKoUb kCKatb"><div><div><span class="sc-bEjUoa sc-boKDdR lhsTlU hetTHz">Array of </span><span class="sc-bEjUoa sc-fOOuSg lhsTlU ffkXKu">arrays</span></div> <div><div html="" class="sc-eVqvcJ sc-fszimp gvxaTx kZZNuK"></div></div></div></td></tr></tbody></table></div></div></div></div>
<p>availabilityManagement が指定されていて、かつ ondemandStart が false のサービスについてはクラスタマネージャを呼び出してサービスを起動する。
サービス定義の読み込みが終わった時点で、SPN Hub での QUIC パケットの受信を開始します。</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="ドキュメントページ"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/devSpecification/SPN/overview"><div class="pagination-nav__sublabel">前へ</div><div class="pagination-nav__label">SPN</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/devSpecification/SPN/crate"><div class="pagination-nav__sublabel">次へ</div><div class="pagination-nav__label">SPN エンドポイント crate</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_TN1Q thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#spn-エンドポイント" class="table-of-contents__link toc-highlight">SPN エンドポイント</a></li><li><a href="#spn-セッション" class="table-of-contents__link toc-highlight">SPN セッション</a><ul><li><a href="#エンドポイント側セッション管理" class="table-of-contents__link toc-highlight">エンドポイント側セッション管理</a></li></ul></li><li><a href="#spn-コネクション" class="table-of-contents__link toc-highlight">SPN コネクション</a><ul><li><a href="#コネクションの終了" class="table-of-contents__link toc-highlight">コネクションの終了</a></li><li><a href="#コネクションの中断と再開" class="table-of-contents__link toc-highlight">コネクションの中断と再開</a></li><li><a href="#エンドポイント状態遷移" class="table-of-contents__link toc-highlight">エンドポイント状態遷移</a></li><li><a href="#provider-のマルチインスタンスについて" class="table-of-contents__link toc-highlight">Provider のマルチインスタンスについて</a></li></ul></li><li><a href="#spnhub-コマンド" class="table-of-contents__link toc-highlight">spnhub コマンド</a><ul><li><a href="#1-レルムの読み込み" class="table-of-contents__link toc-highlight">1. レルムの読み込み</a></li><li><a href="#2-spn-hub-の構築" class="table-of-contents__link toc-highlight">2. SPN Hub の構築</a></li><li><a href="#3-サービスの構築" class="table-of-contents__link toc-highlight">3. サービスの構築</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Procube Co,Ltd. Built on 2025/08/01 09:04.</div></div></div></footer></div>
</body>
</html>